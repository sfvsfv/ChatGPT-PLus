import{_ as W}from"./index-393f84c9.js";import{m as I}from"./marked.esm-76161808.js";import{A as X}from"./badWords-a1983f8f.js";import{d as K,r as f,Q as P,x as Z,o as _,c as S,e as t,f as l,R as T,S as V,b as o,k as d,w as ee,I as U,a as x,t as m,U as te,P as D,E as le,h as s,X as ae,q as L}from"./index-4223df14.js";import{u as ne}from"./utcformatTime-e76e5157.js";import{T as oe,U as se,q as re,r as ue}from"./index-c8c038ff.js";const ie=["src"],de={class:"answer"},pe=["innerHTML"],_e=K({__name:"violation",setup(ce){const Y=new I.Renderer;I.setOptions({renderer:Y,gfm:!0,pedantic:!1,sanitize:!1});const b=f(!1),z=f([]),A=f(),O=f(0),u=P({userId:"",typeOriginCn:"",page:1,size:10}),R=f([]),g=f(!1),c=P({status:0,id:0});function q(n){g.value=!0,c.status=n.status,c.id=n.userId}async function B(){(await D.updateUserStatus(c)).success&&le({type:"success",message:"变更用户状态成功！"}),g.value=!1}async function v(){b.value=!0;try{const n=await X.queryViolation(u);b.value=!1;const{rows:a,count:w}=n.data;O.value=w,R.value=a}catch{b.value=!1}}async function j(n){const a=await D.queryAllUser({size:30,username:n});z.value=a.data.rows}function E(n){n==null||n.resetFields(),v()}return Z(()=>{v()}),(n,a)=>{const w=s("el-option"),C=s("el-select"),y=s("el-form-item"),h=s("el-button"),M=s("el-form"),N=W,r=s("el-table-column"),k=s("el-tag"),F=s("el-popover"),H=s("el-table"),J=s("el-pagination"),$=s("el-row"),G=s("el-dialog"),Q=ae("loading");return _(),S("div",null,[t(N,null,{default:l(()=>[t(M,{ref_key:"formRef",ref:A,inline:!0,model:u},{default:l(()=>[t(y,{label:"用户名称",prop:"userId"},{default:l(()=>[t(C,{modelValue:u.userId,"onUpdate:modelValue":a[0]||(a[0]=e=>u.userId=e),filterable:"",clearable:"",remote:"","reserve-keyword":"",placeholder:"用户姓名[模糊搜索]","remote-show-suffix":"","remote-method":j},{default:l(()=>[(_(!0),S(T,null,V(o(z),e=>(_(),U(w,{key:e.id,label:e.username,value:e.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"检测平台",prop:"typeOriginCn"},{default:l(()=>[t(C,{modelValue:u.typeOriginCn,"onUpdate:modelValue":a[1]||(a[1]=e=>u.typeOriginCn=e),placeholder:"请选择检测平台",clearable:""},{default:l(()=>[(_(!0),S(T,null,V(o(oe),e=>(_(),U(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(y,null,{default:l(()=>[t(h,{type:"primary",onClick:v},{default:l(()=>[d(" 查询 ")]),_:1}),t(h,{onClick:a[2]||(a[2]=e=>E(o(A)))},{default:l(()=>[d(" 重置 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),t(N,{style:{width:"100%"}},{default:l(()=>[ee((_(),U(H,{border:"",data:o(R),style:{width:"100%"},size:"large","tooltip-options":{}},{default:l(()=>[t(r,{fixed:"",prop:"userInfo.username",label:"用户名称",width:"150"}),t(r,{prop:"userInfo.avatar",label:"头像",width:"120"},{default:l(e=>{var i,p;return[x("img",{src:(p=(i=e.row)==null?void 0:i.userInfo)==null?void 0:p.avatar,style:{height:"50px"}},null,8,ie)]}),_:1}),t(r,{prop:"userInfo.email",label:"邮箱",width:"200"}),t(r,{prop:"status",label:"用户状态",width:"120",align:"center"},{default:l(({row:e})=>[t(k,{type:o(se)[e.userInfo.status]},{default:l(()=>[d(m(o(re)[e.userInfo.status]),1)]),_:2},1032,["type"])]),_:1}),t(r,{prop:"userInfo.violationCount",label:"累计次数",width:"90",align:"center"}),t(r,{label:"违规类型"},{default:l(e=>[t(k,{type:"danger"},{default:l(()=>{var i,p;return[d(m((i=e.row)!=null&&i.typeCn?JSON.parse((p=e.row)==null?void 0:p.typeCn).join("  |  "):""),1)]}),_:2},1024)]),_:1}),t(r,{label:"违规关键词"},{default:l(e=>{var i,p;return[d(m((i=e.row)!=null&&i.words?JSON.parse((p=e.row)==null?void 0:p.words).join("  |  "):""),1)]}),_:1}),t(r,{prop:"typeOriginCn",label:"违规检测来源",width:"120"},{default:l(e=>[t(k,{type:"success"},{default:l(()=>[d(m(e.row.typeOriginCn),1)]),_:2},1024)]),_:1}),t(r,{prop:"answer",label:"违规内容",width:"200"},{default:l(e=>[t(F,{placement:"top",width:400,trigger:"click"},{reference:l(()=>[x("div",de,m(e.row.content),1)]),default:l(()=>[x("div",{class:"answer_container",innerHTML:o(I)(e.row.content||"")},null,8,pe)]),_:2},1024)]),_:1}),t(r,{prop:"createdAt",label:"违规时间",width:"200"},{default:l(e=>[d(m(o(ne)(e.row.createdAt,"YYYY-MM-DD hh:mm:ss")),1)]),_:1}),t(r,{fixed:"right",label:"操作",width:"120",align:"center"},{default:l(e=>[t(h,{link:"",type:"primary",size:"small",onClick:i=>q(e.row)},{default:l(()=>[d(" 变更用户状态 ")]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,o(b)]]),t($,{class:"flex justify-end mt-5"},{default:l(()=>[t(J,{"current-page":u.page,"onUpdate:currentPage":a[3]||(a[3]=e=>u.page=e),"page-size":u.size,"onUpdate:pageSize":a[4]||(a[4]=e=>u.size=e),class:"mr-5","page-sizes":[10,20,30,50],layout:"total, sizes, prev, pager, next, jumper",total:o(O),onSizeChange:v,onCurrentChange:v},null,8,["current-page","page-size","total"])]),_:1})]),_:1}),t(G,{modelValue:o(g),"onUpdate:modelValue":a[6]||(a[6]=e=>te(g)?g.value=e:null),title:"变更用户状态",width:"500px"},{default:l(()=>[t(M,{model:c,inline:!0},{default:l(()=>[t(y,{label:"用户状态","label-width":"90px"},{default:l(()=>[t(C,{modelValue:c.status,"onUpdate:modelValue":a[5]||(a[5]=e=>c.status=e),placeholder:"请选择用户状态",clearable:""},{default:l(()=>[(_(!0),S(T,null,V(o(ue),e=>(_(),U(w,{key:e.value,label:e.label,value:e.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(y,null,{default:l(()=>[t(h,{type:"primary",onClick:B},{default:l(()=>[d(" 确认变更 ")]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}});typeof L=="function"&&L(_e);export{_e as default};
